<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Notes on the 2021 Migration to ODK - The Drug Ontology</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Notes on the 2021 Migration to ODK";
    var mkdocs_page_input_path = "MigrationNotes.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> The Drug Ontology</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">Basics</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cite/">Cite</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../history/">History</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Editors Guide</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="#">Standard ODK workflows</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/EditorsWorkflow/">Editors Workflow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/ReleaseWorkflow/">Release Workflow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/RepoManagement/">Manage your ODK Repository</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/SettingUpDockerForODK/">Setting up Docker for ODK</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/UpdateImports/">Imports management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/ManageDocumentation/">Managing the documentation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/ContinuousIntegration/">Continuous Integration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../odk-workflows/RepositoryFileStructure/">Your ODK Repository Overview</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Dron specific docs</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../DronReleaseWorkflow/">DrOn Release Workflow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../UpdateComponents/">Updateing DrOn components</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Notes on the 2021 Migration to ODK</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#merge-upper-and-hand-into-a-single-file">Merge upper and hand into a single file</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#comparing-the-new-odk-based-dronowl-with-the-old-dronowl">Comparing the new ODK-based dron.owl with the old dron.owl</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#migration-checklist-for-the-dron-team">Migration checklist for the DrOn team</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#instructions-for-shallow-review">Instructions for shallow review</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#instructions-for-in-depth-review">Instructions for in-depth review</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">The Drug Ontology</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Dron specific docs &raquo;</li>
        
      
        
          <li>Editors Guide &raquo;</li>
        
      
    
    <li>Notes on the 2021 Migration to ODK</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="odk-migration-march-2021">ODK Migration March 2021</h1>
<p>This document summarises the migration process to regular ODK setup in March 2021. It mainly serves historical purposes, tracing some of the decisions that were made, but also provides guidance on how to manage the migration process on the UFBMI side.</p>
<p>The original repo of DrOn was on bitbucket: https://bitbucket.org/uamsdbmi/dron</p>
<p>To make use of the GitHub ecosystem (GitHub actions for CI, GitHub releases), we migrated Dron to GitHub as well. This migration had one major downside: the GitHub maximum file size is 100 MB. This had two consequences:
1. Large Dron components (dron-ndc, dron-ingredient and dron-rxnorm) could not be checked in directly.
2. The Dron history could not be migrated, as the file size restriction applies to the git history as well.</p>
<p>The remainder of the documents details the other key changes.</p>
<h2 id="merge-upper-and-hand-into-a-single-file">Merge upper and hand into a single file</h2>
<p>All the manually edited Dron axioms are now edited in <code>src/ontology/dron-edit.owl</code>. <code>dron-upper.owl</code> and <code>dron-hand.owl</code>, previously managed as separated OWL files, were merged into the new edit file as follows:</p>
<pre><code>merge_release:
    $(ROBOT) merge -i $(SRC) -i components/dron-hand.owl  -i components/dron-upper.owl --collapse-import-closure false -o $(SRC).ofn &amp;&amp; mv $(SRC).ofn $(SRC)
</code></pre>
<h2 id="comparing-the-new-odk-based-dronowl-with-the-old-dronowl">Comparing the new ODK-based dron.owl with the old dron.owl</h2>
<p>The new DrOn release is a bit different than the old one. In the following we will discuss the differences in detail.</p>
<ol>
<li><em>Added imports</em>. Same as in other ontologies, such as OMRSE, we added proper imports to the Relation Ontology RO and BFO. This ensures that DRON modelling is logically consistent with the BFO worldview, which keeps it compatible with other OBO/BFO-based ontologies. This means there are a few changes in and around external axioms, such as:</li>
<li>include BFO/RO axioms</li>
<li>added/removed CHEBI axioms</li>
<li>added/removed PRO axioms</li>
<li><em>Inferred subclasses</em>. If you open <code>src/ontology/dron-edit.owl</code> and run the reasoner, you will notice that DrOn has a good number of inferred-only subsumptions. Inferred-only subsumptions are those that the reasoner can deduce from the given axioms, but that are not <em>asserted</em> as a SubClassOf axiom. Example, if you run the reasoner in Protege, you will find that <a href="http://purl.obolibrary.org/obo/DRON_00001110">Ampicillin / cloxacillin suspension</a> is asserted to be a subclass of <code>drug suspension</code>. However, you will also notice that it can be inferred to be a SubClassOf <code>cloxacillin suspension</code>:</li>
</ol>
<p>[[img/inferred_subs.png]]</p>
<p>It is important to remember that the standard ROBOT pipeline for the main ontology release a) runs the reasoner and b) strips out redundant axioms, see <a href="https://github.com/INCATools/ontology-development-kit/blob/master/docs/ReleaseArtefacts.md#release-artefact-2-full-required">here</a>.
3. <em>Axiom removed due to unsatisfiability</em>: See <a href="https://github.com/matentzn/dron/issues/2">issue</a></p>
<h2 id="migration-checklist-for-the-dron-team">Migration checklist for the DrOn team</h2>
<p>The following section is intended as a guide for the DrOn team to fully migrate to the new ODK version of DrOn. The steps that need to be taken are as follows:</p>
<ol>
<li>Perform the repo review (see below)</li>
<li>Migrate the GitHub repo to the <code>ufbmi</code> GitHub organisation</li>
<li>Make a test release according <a href="../DronReleaseWorkflow/">the instructions</a></li>
</ol>
<p>If there are problems along the way, the Knocean team will help you sort them out.</p>
<p>Below, we will first provide some instructions for a <em>shallow must-do</em> review, and then give some pointers to additional stuff that could be reviewed if the DrOn team is so inclined. </p>
<h3 id="instructions-for-shallow-review">Instructions for shallow review</h3>
<p><em>Note:</em> When reviewing diffs, its good to keep in mind that lines starting with a <code>-</code> have been removed from the original DrOn, and lines with a <code>+</code> have been added.</p>
<ul>
<li>Open ODK-based dron.owl (top level of GitHub repo) in Protege, side by side with the current dron.owl release (from Bitbucket) and spent 10 minutes looking for oddities in the upper levels of the class hierarchy (and perhaps a dozen terms and their annotations).</li>
<li>Review <a href="https://www.dropbox.com/s/jia55otxatn71l9/dron-release-diff-merged.txt?dl=0">release-to-merge diff (DrOn only)</a>. This is the most important diff, which contains <em>all axioms that actually involve DrOn classes</em> that have changed between the current dron.owl release (from Bitbucket) and the merged form of the edit file (so essentially running <code>robot merge</code> on <code>src/ontology/dron-edit.owl</code>). This should be empty, or tiny. Currently, the only axiom in the diff head to be removed because of unsatisfiability (see <a href="https://github.com/matentzn/dron/issues/2">issue</a>).</li>
<li>Review <a href="https://www.dropbox.com/s/vo1s8ehtizdmp5a/dron-release-diff-build.txt?dl=0">release-to-build diff (DrOn only)</a> (only elements that actually involve DrOn classes). This is already considerably larger, containing all axioms that have changed between the current dron.owl release (from Bitbucket) and the <em>ODK-released</em> version of DrOn. It is worth cherry picking some axioms from the diff and checking them in Protege (open dron-edit.owl in Protege and run Elk reasoner). See above section on inference and imports in ODK-based dron.owl.</li>
</ul>
<h3 id="instructions-for-in-depth-review">Instructions for in-depth review</h3>
<ul>
<li>Review <a href="https://www.dropbox.com/s/8pt56w13o9dgzu8/release-diff-merged.txt?dl=0">release-to-merge diff (non DrOn (external stuff))</a>. This is a huge diff including axioms that are due to changes in imported ontologies. Of the roughly 99% of these changes are due to the refreshed CHEBI import (80K changes). We believe its worth trying to identify patterns in these changes, like missing properties. Not that this is using the exact same config as OMRSE, so Matt D. should be quite familiar reviewing these.</li>
<li>Review <a href="https://www.dropbox.com/s/2z7eiv11k0ago11/release-diff-build.txt?dl=0">release-to-build diff (non DrOn (external stuff)</a>. This (equally huge) diff includes all non-DrOn axioms that have changed between the current dron.owl release (from Bitbucket) and the <em>ODK-released</em> version of DrOn. This is 99% redundant with the above release-to-merge diff, so we recommend to disregard it.</li>
<li>Become aware of issues we noticed during the work:</li>
<li><a href="https://github.com/matentzn/dron/issues/3">Has-proper-part and has-part usage Dron not compatible with RO</a></li>
<li><a href="https://github.com/matentzn/dron/issues/1">Dron uses BFO:0000053 which is neither in RO nor BFO</a></li>
<li>Close the unsatisfiable classes <a href="https://github.com/matentzn/dron/issues/2">issue</a>.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../UpdateComponents/" class="btn btn-neutral" title="Updateing DrOn components"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../UpdateComponents/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
